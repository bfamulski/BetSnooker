<div *ngIf="loading" class="center-container">
  <span class="spinner-border spinner-border-lm" style="display: inline-block; margin: 50px;"></span>
</div>

<div *ngIf="!loading && !error">
  <!-- Users statistics -->
  <div style="margin-top: 10px;">
    <table class="table table-responsive" *ngIf="!loading && usersScores">
      <thead class="table-sub-header">
        <tr>
          <th style="text-align: left;">USER</th>
          <th style="text-align: right;">MATCHES</th>
          <th style="text-align: right;">WINNER</th>
          <th style="text-align: right;">EX. SCORE</th>
          <th style="text-align: right;">ACCURACY</th>
          <th style="text-align: right;">SCORE</th>
      </thead>
      <tbody>
        <tr mdbTableCol *ngFor="let user of users">
          <td style="text-align: left; font-weight: bold; width: 540px;">{{user.username}}</td>
          <td style="text-align: right; width: 80px;">{{usersScores[user.username] ? usersScores[user.username].matchesFinished : 0}}</td>
          <td style="text-align: right; width: 80px;">{{usersScores[user.username] ? usersScores[user.username].correctWinners : 0}}</td>
          <td style="text-align: right; width: 80px;">{{usersScores[user.username] ? usersScores[user.username].exactScores : 0}}</td>
          <td style="text-align: right; width: 140px;">
            {{usersScores[user.username] ? usersScores[user.username].correctWinnersAccuracy : 0.0}}% 
            ({{usersScores[user.username] ? usersScores[user.username].exactScoresAccuracy : 0.0}}%)
          </td>
          <td style="text-align: right; width: 50px; font-weight: bold;">{{usersScores[user.username] ? usersScores[user.username].eventScore : 0.0}}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Rounds and matches -->
  <div *ngFor="let round of eventRounds">
    <table class="table table-responsive" *ngIf="!loading">
      <thead class="table-header">
        <tr style="padding: 0px;">
          <th style="text-align: center;" colspan="5">{{round.roundName}} ({{round.distance * 2 - 1}})</th>
          <th *ngFor="let user of users" colspan="4"></th>
        </tr>
      </thead>
      <thead class="table-sub-header">
        <tr style="padding: 0px;">
          <th style="text-align: right;">PLAYER 1</th>
          <th style="text-align: right;"></th> <!--SCORE1-->
          <th style="text-align: center;"></th> <!-- : -->
          <th style="text-align: left;"></th> <!--SCORE2-->
          <th style="text-align: left;">PLAYER 2</th>
          <th></th>
          <th *ngFor="let user of users" style="text-align: center;">{{user.username}}</th>
      </thead>

      <tbody>
        <tr mdbTableCol *ngFor="let item of dashboardItems | roundFilter: {round: round.round}">
          <td [ngClass]="{'winner-item': item.player1Id === item.winnerId}" style="text-align: right; width: 400px;">{{item.player1Name}}</td>
          <td style="text-align: right; font-weight: bold; width: 20px;">{{item.score1}}</td>
          <td style="text-align: center; width: 20px;">:</td>
          <td style="text-align: left; font-weight: bold; width: 20px;">{{item.score2}}</td>
          <td [ngClass]="{'winner-item': item.player2Id === item.winnerId}" style="text-align: left; width: 400px;">{{item.player2Name}}</td>
          <td></td>
          <td *ngFor="let user of users" style="width: 100px;  padding-left: 18px;">
            <table style="margin: -5px;" *ngIf="item.userBets[user.username]">
              <tr>
                <td style="text-align: center; font-weight: bold;">{{item.userBets[user.username]?.betScore1}}</td>
                <td style="text-align: center;">:</td>
                <td style="text-align: center; font-weight: bold; padding-right: 8px;">{{item.userBets[user.username]?.betScore2}}</td>
                <td *ngIf="item.userBets[user.username]?.scoreValue != null"
                    [ngClass]="{'max-points': item.userBets[user.username]?.scoreValue === (item.roundBestOf + 1) / 2,
                                'zero-points': item.userBets[user.username]?.scoreValue === 0,
                                'in-between-points': item.userBets[user.username]?.scoreValue !== (item.roundBestOf + 1) / 2 && item.userBets[user.username]?.scoreValue !== 0}" 
                    style="text-align: center; font-weight: bold; width: 35px; min-width: 35px;">{{item.userBets[user.username]?.scoreValue}}</td>
              </tr>
            </table>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div *ngIf="error" class="alert alert-danger mt-3 mb-0">{{error}}</div>